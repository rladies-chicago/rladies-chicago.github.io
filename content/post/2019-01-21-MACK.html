---
title: "Introducing Chicago Schools Enrollment Data to R"
author: "Charlotte Mack"
date: "2019-01-24"
output: html_document
categories: ["R"]
tags: ["community", "rladies","data","chicago"]
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/plotly-binding/plotly.js"></script>
<script src="/rmarkdown-libs/typedarray/typedarray.min.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/crosstalk/js/crosstalk.min.js"></script>
<link href="/rmarkdown-libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="/rmarkdown-libs/plotly-main/plotly-latest.min.js"></script>


<p>The City of Chicago and Chicago Public Schools (CPS) have made data on annual enrollments, school locations, and other school features available to the public. After a bit of wrangling (frankly maybe more than just a bit) these data can be used in R to get key visualizations.</p>
<p>My own interest in the schools data began with a desire to understand more about the spread of charter schools in the city, and also more about the sharp enrollment declines that some regular public high schools have experienced since the early ’00s. Putting together the annual enrollment data provided by the CPS into a longitudinal form gave some insights into both questions. In addition, the City provides a shapefile of school locations as of the 2014-2015 school year that has enough information to make a first pass at seeing the expansion of schools of other-than-regular governance. In this post I’ll share those illustrations.</p>
<pre class="r"><code>library(tidyverse)
library(lubridate)</code></pre>
<p>The <a href="https://github.com/cymack/CPSenrollment">all-high school enrollment data.frame</a> is available at my github site in <a href="https://github.com/cymack/CPSenrollment/blob/master/enrollment_all_hs.csv">csv</a> and <a href="https://github.com/cymack/CPSenrollment/blob/master/enrollment_all_hs.Rds">Rds</a> formats. In the command below we use RCurl::getURL to get the csv version directly from the raw files at github.</p>
<pre class="r"><code># The enrollment data#
require(&quot;RCurl&quot;)
library(RCurl)

enrollment_all_hs &lt;-read.csv(text=getURL(&quot;https://raw.githubusercontent.com/cymack/CPSenrollment/master/enrollment_all_hs.csv&quot;)) </code></pre>
<p>For most years, school governance, as I’ve called it, has only two levels, “regular” and “charter.” In 2016 a third level appears for the first time, “contract.” As there were only 4 contract high schools in that year, I’ve collapsed that factor with charter to create “charter etc.” Then I extracted a table of annual counts of regular and charter etc schools, and plotted a graph.</p>
<pre class="r"><code>tbl.allschools_years_gov &lt;- 
  enrollment_all_hs %&gt;% 
  dplyr::mutate(govern = forcats::as_factor(govern)) %&gt;% 
  dplyr::mutate(govern = forcats::fct_collapse(govern, &quot;charter etc&quot; = c(&quot;charter&quot;, &quot;other&quot;))) %&gt;%
  dplyr::group_by(year, govern) %&gt;% 
  dplyr::count()

# tbl.allschools_years_gov %&gt;% print(n=24)
    
# So in any table or graph derived from this frame, the &quot;charter etc&quot; factor includes
# contract or other schools that in the main data frame are factored separately
# as &quot;other.&quot;</code></pre>
<div id="htmlwidget-1" style="width:480px;height:384px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"data":[{"x":[13149,13514,13879,14245,14610,14975,15340,15706,16071,16436,16801,17167],"y":[11,17,26,36,21,27,36,50,75,79,50,89],"text":["n:  11","n:  17","n:  26","n:  36","n:  21","n:  27","n:  36","n:  50","n:  75","n:  79","n:  50","n:  89"],"type":"scatter","mode":"markers+lines","marker":{"autocolorscale":false,"color":"rgba(255,255,0,1)","opacity":0.6,"size":11.3385826771654,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)"}},"hoveron":"points","name":"(charter etc,1)","legendgroup":"(charter etc,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","line":{"width":1.88976377952756,"color":"rgba(0,0,0,0.1)","dash":"solid"},"frame":null},{"x":[13149,13514,13879,14245,14610,14975,15340,15706,16071,16436,16801,17167],"y":[115,114,116,109,131,129,116,105,110,113,142,97],"text":["n: 115","n: 114","n: 116","n: 109","n: 131","n: 129","n: 116","n: 105","n: 110","n: 113","n: 142","n:  97"],"type":"scatter","mode":"markers+lines","marker":{"autocolorscale":false,"color":"rgba(0,0,139,1)","opacity":0.6,"size":11.3385826771654,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)"}},"hoveron":"points","name":"(regular,1)","legendgroup":"(regular,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","line":{"width":1.88976377952756,"color":"rgba(0,0,0,0.1)","dash":"dash"},"frame":null},{"x":[14245],"y":[75],"text":"Most striking dynamic element <br />in number of schools <br />is the growth of charters.","hovertext":"y: 75","textfont":{"size":11.3385826771654,"color":"rgba(0,0,0,1)"},"type":"scatter","mode":"text","hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[16436],"y":[125],"text":"regular","hovertext":"y: 125","textfont":{"size":11.3385826771654,"color":"rgba(0,0,0,0.5)"},"type":"scatter","mode":"text","hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[16436],"y":[40],"text":"charter etc","hovertext":"y: 40","textfont":{"size":11.3385826771654,"color":"rgba(0,0,0,0.5)"},"type":"scatter","mode":"text","hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":42.6666666666667,"r":7.30593607305936,"b":39.0867579908676,"l":43.1050228310502},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":"CPS High Schools by Year and Type, 2006 -- 2017","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[12948.1,17367.9],"tickmode":"array","ticktext":["2006","2008","2010","2012","2014","2016"],"tickvals":[13149,13879,14610,15340,16071,16801],"categoryorder":"array","categoryarray":["2006","2008","2010","2012","2014","2016"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"Year","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[4.45,148.55],"tickmode":"array","ticktext":["50","100"],"tickvals":[50,100],"categoryorder":"array","categoryarray":["50","100"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":"Number of Schools","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false},"source":"A","attrs":{"13ad1fb68711":{"fill":{},"text":{},"x":{},"y":{},"type":"scatter"},"13ad85d7d5b":{"linetype":{},"x":{},"y":{}},"13ad31d0e5a7":{"x":{},"y":{}},"13ad995507e":{"x":{},"y":{}},"13ad29d7851c":{"x":{},"y":{}}},"cur_data":"13ad1fb68711","visdat":{"13ad1fb68711":["function (y) ","x"],"13ad85d7d5b":["function (y) ","x"],"13ad31d0e5a7":["function (y) ","x"],"13ad995507e":["function (y) ","x"],"13ad29d7851c":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":[]}</script>
<p>So the visual evidence from this graph is that the number of charter and other schools of non-standard governance types has increased over the period, and that this increase has been the main dynamic in the number of high schools under CPS jurisdiction, since the number of regular schools has oscillated in a more steady manner. Though there is some up-and-downness, the share of non-standard schools has increased significantly.</p>
<p>We can get another perspective on the growth of the number of charter institutions by mapping school locations at different time points. The City of Chicago has, among numerous data files at its <a href="https://data.cityofchicago.org/">data hub site</a>, a shapefile of <a href="https://data.cityofchicago.org/Education/Chicago-Public-Schools-School-Locations-SY1415/3fhj-xtn5">school locations in the year 2014-2015</a>. After some manipulations I’ve come up with spatial data.frames in sf (simple features) format for schools appearing in the enrollment_all_hs frame and the location frame, for the each of the years <a href="https://github.com/cymack/CPSenrollment/blob/master/school_loc_merged.2006.Rds">2006-2007</a> and <a href="https://github.com/cymack/CPSenrollment/blob/master/school_loc_merged.2016.Rds">2016-2017</a>, available on my github site at the links. Again RCurl::getURL in the code chunk is aimed at the raw github files. It is hoped that in the first pass visualization the noise occasioned by mixing data across three years be overwhelmed by strength of the main effect.</p>
<p><img src="/post/2019-01-21-MACK_files/figure-html/maps-1.png" width="672" style="display: block; margin: auto auto auto 0;" /></p>
<p>Another caveat is that the school types in the maps are derived from the locations data provided by the City of Chicago, and appears to be a different categorization from that in the CPS enrollment data set. The difference seems to affect mostly the charter and other options school types. In this case combining the charter and all other types into one factor level might actually have helped.</p>
<p>Clearly visible in the maps is the increase in number of high schools overall from 2006 to 2016. The increased density of locations is especially noticeable in the central area of the city, roughly to the west of downtown.</p>
<div id="about-the-author" class="section level4">
<h4>About the Author:</h4>
<p>Charlotte Mack is a former economist who is interested in the use of R and other open source data platforms with public data as part of civic activities. She also enjoys black-and-white movies and television, and has recently added new tango to her numerous musical enthusiasms.</p>
<svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 496 512">
<path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/>
</svg>
<p><a href="https://github.com/cymack">cymack</a></p>
</div>
